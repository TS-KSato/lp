**検討中のルーレットLP実装**

ページの構成を考えています。`<head>`部分ではmeta viewportタグや、必要なCSS（オーバーレイ、ポップアップ、ルーレットホイールなど）を定義したいです。また、ポップアップロジックをして、HTMLでは「Welcome to Roulette LP」タイトルとともに隠れたオーバーレイを扱います。JSでは、ポップアップ表示やルーレットホイールに関するCSSでの実装をし、アニメーションや乱数機能を取り入れます。画像やアニメの遅延読み込みなどもポイントです。

**構築するロッタLP**

ページの読み込み時に、JavaScriptで自動的にルーレットを1回転させ、確率に基づいてランダムなセグメントを選び、回転を停止させます。もし「ダイヤモンド」セグメントが当たれば、「勝者」ボタンを表示。CSSアニメーションは最適化し、パフォーマンスを安定させるために画像を遅延読み込みします。エラーハンドリングや、セグメントが欠けている場合のフォールバックも組み込み。最終的に、必要なHTMLコードを提供します。


思考時間: 47 秒


```html
<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />

  <title>Roulette Landing Page</title>

  <!-- ======  Styles  ====== -->
  <style>
    /* --- Base reset ------------------------------------------------------ */
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    /* --- Top‑page placeholder ------------------------------------------- */
    body {
      font-family: -apple-system, BlinkMacSystemFont, Segoe UI, Roboto, Helvetica, Arial,
        sans-serif;
      background: #f0f0f0;
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #333;
    }

    #topPage {
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    /* --- Overlay --------------------------------------------------------- */
    #overlay {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.5);
      z-index: 999;
      display: none;
      opacity: 0;
      transition: opacity 0.3s;
    }

    /* --- Popup ----------------------------------------------------------- */
    #popup {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 70vw;
      max-width: 350px;
      min-width: 280px;
      height: 70vw;          /* equal_to_width */
      max-height: 350px;
      min-height: 280px;
      background: #ffffff;
      border-radius: 15px;   /* rounded‑square */
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
      z-index: 1000;
      display: none;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      opacity: 0;
      animation: fadeIn 0.5s forwards;
    }

    @keyframes fadeIn { to { opacity: 1; } }

    /* --- Roulette wheel -------------------------------------------------- */
    #wheel {
      position: relative;
      width: 100%;
      height: 100%;
      border-radius: 50%;
      overflow: hidden;
      transition: transform 3s ease-out;
    }

    .segment {
      position: absolute;
      width: 50%;
      height: 50%;
      top: 50%;
      left: 50%;
      transform-origin: 0% 0%;
    }

    .segment img,
    .segment span {
      width: 100%;
      height: 100%;
      object-fit: contain;
      display: block;
    }

    .segment span {
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 12px;
      text-align: center;
      padding: 4px;
    }

    /* --- Buttons --------------------------------------------------------- */
    #winnerBtn,
    #closeBtn {
      margin-top: 12px;
      padding: 8px 16px;
      font-size: 16px;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      opacity: 0;
      animation: fadeIn 0.3s forwards;
      transition: background 0.2s;
    }

    #closeBtn {
      background: transparent;
      color: #333333;
      padding: 8px 16px;
    }

    #winnerBtn {
      display: none;
      background: #ff4500;
      color: #ffffff;
      padding: 12px 24px;
    }

    #winnerBtn:hover { background: #e03e00; }

    /* --- Confetti canvas ------------------------------------------------- */
    #confettiCanvas {
      position: fixed;
      inset: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 1100;
      display: none;
    }
  </style>
</head>

<body>
  <!-- ======  Top page placeholder  ====== -->
  <main id="topPage">
    <h1>Welcome to Roulette LP</h1>
  </main>

  <!-- ======  Overlay  ====== -->
  <div id="overlay" aria-label="ルーレットポップアップ"></div>

  <!-- ======  Popup  ====== -->
  <div id="popup" role="dialog" aria-modal="true" aria-labelledby="wheel">
    <div id="wheel" aria-label="ラッキールーレット"></div>

    <button id="winnerBtn"
            aria-label="特典受け取りボタン"
            target="_blank">
      おめでとう！特典を受け取る
    </button>

    <button id="closeBtn" aria-label="ポップアップを閉じる">閉じる</button>
  </div>

  <!-- ======  Confetti  ====== -->
  <canvas id="confettiCanvas"></canvas>

  <!-- ======  Script  ====== -->
  <script>
    /* ---------------------------------------------------------------------
       Configuration  (customize freely where noted)
    --------------------------------------------------------------------- */
    const CONFIG = {
      /* Winner‑button link (customizable) */
      winnerButtonUrl: 'https://example.com',

      /* Segments & probabilities (customizable) */
      segments: [
        { symbol: 'cherry',     svg: 'cherry.svg',     alt: 'Cherry',     probability: 20 },
        { symbol: 'lemon',      svg: 'lemon.svg',      alt: 'Lemon',      probability: 15 },
        { symbol: 'orange',     svg: 'orange.svg',     alt: 'Orange',     probability: 15 },
        { symbol: 'grape',      svg: 'grape.svg',      alt: 'Grape',      probability: 15 },
        { symbol: 'apple',      svg: 'apple.svg',      alt: 'Apple',      probability: 10 },
        { symbol: 'watermelon', svg: 'watermelon.svg', alt: 'Watermelon', probability: 10 },
        { symbol: 'diamond',    svg: 'diamond.svg',    alt: 'Diamond',    probability: 5,  isWinner: true },
        { symbol: 'star',       svg: 'star.svg',       alt: 'Star',       probability: 10 }
      ]
    };

    /* ---------------------------------------------------------------------
       Helpers
    --------------------------------------------------------------------- */
    function normalizeProbabilities(list) {
      const total = list.reduce((sum, s) => sum + s.probability, 0);
      if (total !== 100) {
        console.warn('Probability mismatch. Normalizing.');  /* error handling */
        list.forEach(s => (s.probability = (s.probability / total) * 100));
      }
    }

    function pickSegment(list) {
      const r = Math.random() * 100;
      let acc = 0;
      for (const seg of list) {
        acc += seg.probability;
        if (r <= acc) return seg;
      }
      return list[list.length - 1]; /* fallback */
    }

    /* ---------------------------------------------------------------------
       Build wheel
    --------------------------------------------------------------------- */
    function buildWheel(el, list) {
      const total = list.length;
      const slice = 360 / total;
      list.forEach((seg, i) => {
        const s = document.createElement('div');
        s.className = 'segment';
        s.style.transform = `rotate(${i * slice}deg) skewY(${90 - slice}deg)`;

        const img = document.createElement('img');
        img.loading = 'lazy';
        img.src = seg.svg;
        img.alt = seg.alt;
        img.onerror = () => {
          console.error(`Asset ${seg.svg} failed to load, falling back to alt text.`);
          img.remove();
          const span = document.createElement('span');
          span.textContent = seg.alt;
          s.appendChild(span);
        };

        s.appendChild(img);
        el.appendChild(s);
      });
    }

    /* ---------------------------------------------------------------------
       Spin logic
    --------------------------------------------------------------------- */
    function spinWheel() {
      const wheel = document.getElementById('wheel');
      const list  = CONFIG.segments;
      const total = list.length;
      const slice = 360 / total;

      const chosen      = pickSegment(list);
      const chosenIndex = list.indexOf(chosen);
      const spins       = 4;                                    /* extra spins */
      const stopAngle   = 360 * spins
                        + (360 - (chosenIndex * slice) - slice / 2);

      wheel.style.transform = `rotate(${stopAngle}deg)`;

      setTimeout(() => {
        highlightSegment(chosenIndex, total);
        if (chosen.isWinner) celebrateWinner();
      }, 3000);  /* matches rotate duration */
    }

    function highlightSegment(idx, total) {
      const wheel = document.getElementById('wheel');
      const segs  = wheel.getElementsByClassName('segment');
      if (segs[idx]) segs[idx].style.border = '2px solid #ffd700';
    }

    /* ---------------------------------------------------------------------
       Confetti  (simple canvas implementation)
    --------------------------------------------------------------------- */
    function celebrateWinner() {
      const btn = document.getElementById('winnerBtn');
      btn.style.display = 'block';
      launchConfetti();
    }

    function launchConfetti() {
      const canvas = document.getElementById('confettiCanvas');
      const ctx    = canvas.getContext('2d');
      canvas.width  = window.innerWidth;
      canvas.height = window.innerHeight;
      canvas.style.display = 'block';

      const colors   = ['#ff0000', '#00ff00', '#0000ff', '#ffd700'];
      const pieces   = [];
      const maxPieces = 150;

      for (let i = 0; i < maxPieces; i++) {
        pieces.push({
          x: Math.random() * canvas.width,
          y: Math.random() * canvas.height - canvas.height,
          r: Math.random() * 6 + 4,
          d: Math.random() * colors.length,
          tilt: Math.random() * 10,
          tiltIncrement: Math.random() * 0.07 + 0.05,
          tiltAngle: 0
        });
      }

      let frame;
      function draw() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        pieces.forEach(p => {
          ctx.beginPath();
          ctx.lineWidth = p.r / 2;
          ctx.strokeStyle = colors[p.d];
          ctx.moveTo(p.x + p.tilt + p.r / 4, p.y);
          ctx.lineTo(p.x + p.tilt, p.y + p.tilt + p.r / 4);
          ctx.stroke();
        });
        update();
        frame = requestAnimationFrame(draw);
      }

      function update() {
        pieces.forEach(p => {
          p.tiltAngle += p.tiltIncrement;
          p.y += (Math.cos(p.d) + 3 + p.r / 2) / 2;
          p.tilt = Math.sin(p.tiltAngle) * 15;
          if (p.y > canvas.height) p.y = -10;
        });
      }

      draw();
      setTimeout(() => {
        cancelAnimationFrame(frame);
        canvas.style.display = 'none';
      }, 2000);   /* confetti duration */
    }

    /* ---------------------------------------------------------------------
       Popup control & focus‑trap
    --------------------------------------------------------------------- */
    function showPopup() {
      document.getElementById('overlay').style.display = 'block';
      document.getElementById('popup').style.display   = 'flex';

      requestAnimationFrame(() => {
        document.getElementById('overlay').style.opacity = 1;
      });

      document.getElementById('closeBtn').focus();   /* focus management */
      spinWheel();
    }

    function hidePopup() {
      const overlay = document.getElementById('overlay');
      const popup   = document.getElementById('popup');
      overlay.style.opacity = 0;
      popup.style.opacity   = 0;

      setTimeout(() => {
        overlay.style.display = 'none';
        popup.style.display   = 'none';
        popup.style.opacity   = 1;   /* reset */
      }, 300);
    }

    /* ---------------------------------------------------------------------
       Init
    --------------------------------------------------------------------- */
    document.addEventListener('DOMContentLoaded', () => {
      normalizeProbabilities(CONFIG.segments);
      buildWheel(document.getElementById('wheel'), CONFIG.segments);

      document
        .getElementById('winnerBtn')
        .addEventListener('click', () => window.open(CONFIG.winnerButtonUrl, '_blank'));

      document
        .getElementById('closeBtn')
        .addEventListener('click', hidePopup);

      document.addEventListener('keydown', e => {
        if (e.key === 'Escape') hidePopup();             /* keyboard navigation */
      });

      /* Display popup on page‑load (spec) */
      showPopup();
    });
  </script>
</body>
</html>
```
