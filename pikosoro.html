<!DOCTYPE html>
<html lang="ja" data-theme="auto">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0,viewport-fit=cover">
  <title>„Éî„Ç≥„Åù„Çç¬†Pro</title>
  <!-- Ê≠£„Åó„ÅÑ Base64 „Éû„Éã„Éï„Çß„Çπ„ÉàÔºöChrome „ÅÆ syntax error „ÇíËß£Ê∂à -->
  <link rel="manifest" href="data:application/manifest+json;base64,eyJuYW1lIjoiUGlrb3Nvcm8gUHJvIiwic2hvcnRfbmFtZSI6IlBpa29zb3JvIiwic3RhcnRfdXJsIjoiLiIsImRpc3BsYXkiOiJzdGFuZGFsb25lIiwidGhlbWVfY29sb3IiOiIjMDAwMDAwIiwiYmFja2dyb3VuZF9jb2xvciI6IiNmZmZmZmYifQ==">
  <style>
    /* ---------------- RESET ---------------- */
    *,*::before,*::after{box-sizing:border-box;margin:0;padding:0;-webkit-tap-highlight-color:transparent}
    body{font-family:-apple-system,BlinkMacSystemFont,"Helvetica Neue","Hiragino Kaku Gothic ProN","Yu Gothic",Meiryo,sans-serif;line-height:1.5;min-height:100vh;display:flex;flex-direction:column;background:var(--bg-primary);color:var(--text-primary)}

    /* -------------- THEME TOKENS -------------- */
    :root{--light-bg-primary:#fafafa;--light-text-primary:#121212;--light-border:#e1e1e1;--dark-bg-primary:#000;--dark-text-primary:#fff;--dark-border:#2c2c2e;--accent:#1e90ff;--radius:10px}
    @media(prefers-color-scheme:light){:root{--bg-primary:var(--light-bg-primary);--text-primary:var(--light-text-primary);--border:var(--light-border)}}
    @media(prefers-color-scheme:dark){:root{--bg-primary:var(--dark-bg-primary);--text-primary:var(--dark-text-primary);--border:var(--dark-border)}}
    html[data-theme="light"]{--bg-primary:var(--light-bg-primary);--text-primary:var(--light-text-primary);--border:var(--light-border)}
    html[data-theme="dark"]{--bg-primary:var(--dark-bg-primary);--text-primary:var(--dark-text-primary);--border:var(--dark-border)}

    /* -------------- LAYOUT -------------- */
    header{display:flex;justify-content:space-between;align-items:center;padding:12px 16px}
    header h1{font-size:18px;font-weight:600}
    .icon-btn{background:none;border:none;font-size:20px;width:36px;height:36px;border-radius:var(--radius);display:flex;align-items:center;justify-content:center;color:var(--accent);cursor:pointer}
    .icon-btn:active{opacity:.6}
    main{flex:1;display:flex;flex-direction:column;gap:16px;padding:0 16px 24px}

    /* -------------- ABACUS -------------- */
    .abacus{display:grid;grid-template-columns:repeat(13,1fr);gap:8px;justify-content:center;margin:auto;width:100%}
    .rod{display:flex;flex-direction:column-reverse;gap:4px;align-items:center}
    .bead{width:20px;height:20px;border-radius:50%;background:var(--accent);cursor:pointer;transition:transform .2s}
    .bead.top{margin-bottom:8px}
    .bead.active{transform:translateY(-24px)}
    .separator{height:2px;background:var(--border);grid-column:1/-1;margin-bottom:8px}

    /* -------------- DISPLAY -------------- */
    #valueDisplay{font-size:28px;font-weight:500;text-align:right;border:1px solid var(--border);padding:4px 8px;border-radius:var(--radius);margin-bottom:12px}

    /* -------------- CALCULATOR -------------- */
    .calculator{display:grid;grid-template-columns:repeat(4,1fr);gap:8px;margin-top:8px}
    .calc-btn{padding:12px 0;border:none;border-radius:var(--radius);font-size:18px;font-weight:500;background:#333;color:#fff;cursor:pointer}
    .calc-btn.op{background:#555}
    .calc-btn.eq{background:var(--accent)}

    /* -------------- TOAST -------------- */
    .toast{position:fixed;left:50%;bottom:24px;transform:translateX(-50%) scale(.9);background:var(--text-primary);color:var(--bg-primary);padding:8px 14px;border-radius:var(--radius);opacity:0;pointer-events:none;transition:opacity .3s,transform .3s}
    .toast.show{opacity:1;transform:translateX(-50%) scale(1)}

    /* -------------- ACCESSIBILITY -------------- */
    *:focus-visible{outline:2px solid var(--accent);outline-offset:2px}
  </style>
</head>
<body>
  <header>
    <h1>„Éî„Ç≥„Åù„Çç¬†Pro</h1>
    <nav>
      <button class="icon-btn" id="themeBtn" aria-label="„ÉÜ„Éº„ÉûÂàáÊõø">üåì</button>
      <button class="icon-btn" id="infoBtn" aria-label="ÊÉÖÂ†±">‚ÑπÔ∏è</button>
    </nav>
  </header>
  <main>
    <div id="valueDisplay" aria-live="polite">0</div>
    <section class="abacus" id="abacus"></section>
    <section class="calculator" id="calculator"></section>
  </main>
  <div id="toast" class="toast" role="status" aria-live="assertive"></div>

  <script>
    /* ---------------- helpers ---------------- */
    const $=s=>document.querySelector(s);
    function toast(msg){const t=$("#toast");t.textContent=msg;t.classList.add("show");setTimeout(()=>t.classList.remove("show"),2000)}

    /* ---------------- theme toggle ---------------- */
    $("#themeBtn").addEventListener("click",()=>{
      const root=document.documentElement;
      const next=root.dataset.theme==="dark"?"light":root.dataset.theme==="light"?"auto":"dark";
      if(next==="auto"){delete root.dataset.theme}else root.dataset.theme=next;
      toast(next==="auto"?"Ëá™Âãï":"„ÉÜ„Éº„Éû:"+next);
    });

    /* ---------------- ABACUS BUILD ---------------- */
    const rods=13,bottom=4; // 1 top, 4 bottom beads
    const abacus=$("#abacus");
    const state=Array.from({length:rods},()=>({top:false,bottom:0}));
    for(let r=0;r<rods;r++){
      const rod=document.createElement("div");
      rod.className="rod";
      const topBead=document.createElement("div");
      topBead.className="bead top";
      rod.appendChild(topBead);
      for(let i=0;i<bottom;i++){
        const bead=document.createElement("div");
        bead.className="bead bottom";
        rod.appendChild(bead);
      }
      abacus.appendChild(rod);
    }
    const sep=document.createElement("div");
    sep.className="separator";
    abacus.appendChild(sep);

    function updateDisplay(){
      const value=state.reduce((sum,d,idx)=>sum+((d.top?5:0)+d.bottom)*10**(rods-idx-1),0);
      $("#valueDisplay").textContent=value.toLocaleString("ja-JP");
    }

    abacus.addEventListener("click",e=>{
      const bead=e.target;
      if(!bead.classList.contains("bead"))return;
      const rodElem=bead.parentElement;
      const idx=[...abacus.children].filter(el=>el.classList.contains("rod")).indexOf(rodElem);
      const data=state[idx];
      if(bead.classList.contains("top")){
        data.top=!data.top;
        bead.classList.toggle("active",data.top);
      }else{
        const beads=[...rodElem.querySelectorAll(".bead.bottom")];
        const i=beads.indexOf(bead);
        const target=i+1;
        data.bottom=target;
        beads.forEach((b,j)=>b.classList.toggle("active",j<i+1));
      }
      updateDisplay();
    });
    updateDisplay();

    /* ---------------- CALCULATOR ---------------- */
    const keys=["7","8","9","√∑","4","5","6","√ó","1","2","3","-","0",".","=","+"];
    const calc=$("#calculator");
    let expr="";
    keys.forEach(k=>{
      const b=document.createElement("button");
      b.textContent=k;
      b.className="calc-btn";
      if("√∑√ó-+".includes(k))b.classList.add("op");
      if(k==="=")b.classList.add("eq");
      b.addEventListener("click",()=>{
        if(k==="="){
          try{const result=Function(`return (${expr.replace(/√ó/g,'*').replace(/√∑/g,'/')})`)();expr=result.toString();toast("= "+result);}catch{toast("Âºè„Ç®„É©„Éº");}
        }else if(k==="C"){expr="";}
        else expr+=k;
        $("#valueDisplay").textContent=expr||"0";
      });
      calc.appendChild(b);
    });

    /* ---------------- info ---------------- */
    $("#infoBtn").addEventListener("click",()=>toast("„Éî„Ç≥„Åù„Çç¬†Pro¬†1.0.0"));
  </script>
</body>
</html>
