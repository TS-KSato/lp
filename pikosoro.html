<!DOCTYPE html>
<html lang="ja" data-theme="dark">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
  <meta name="color-scheme" content="dark light">
  <title>ãƒ”ã‚³ãã‚â€¯ProÂ â€” SorobanÂ Ã—Â Calculator</title>
  <link rel="manifest" href="data:application/manifest+json,{\"name\":\"ãƒ”ã‚³ãã‚â€¯Pro\",\"short_name\":\"ãƒ”ã‚³ãã‚\",\"start_url\":\"./index.html\",\"display\":\"standalone\",\"theme_color\":\"#000000\",\"background_color\":\"#ffffff\"}">
  <style>
    /* ------------------------------------
       01.Â CSSÂ RESET &Â BASE TYPOGRAPHY
    ------------------------------------ */
    *,*::before,*::after{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent}
    html{-webkit-text-size-adjust:100%;font-family:-apple-system,BlinkMacSystemFont,"Helvetica Neue","Hiragino Kaku Gothic ProN","Yu Gothic UI","Meiryo UI",sans-serif;line-height:1.5}
    body{min-height:100vh;background:var(--bg-primary);color:var(--text-primary);display:flex;flex-direction:column;user-select:none;-webkit-font-smoothing:antialiased;overscroll-behavior-y:none}
    img{max-width:100%;height:auto}

    /* ------------------------------------
       02.Â THEMEÂ TOKENS
    ------------------------------------ */
    :root{
      /* light */
      --light-bg-primary:#fafafa;--light-bg-secondary:#ffffff;--light-bg-tertiary:#f1f1f3;
      --light-text-primary:#1c1c1e;--light-text-secondary:#636366;--light-text-tertiary:#8e8e93;
      --light-border:#e5e5ea;--light-shadow:rgba(0,0,0,.06);
      /* dark */
      --dark-bg-primary:#000000;--dark-bg-secondary:#0a0a0a;--dark-bg-tertiary:#141414;
      --dark-text-primary:#ffffff;--dark-text-secondary:#8e8e93;--dark-text-tertiary:#48484a;
      --dark-border:#1c1c1e;--dark-shadow:rgba(0,0,0,.8);

      /* accent palette (shared) */
      --accent:#007aff;--success:#34c759;--warning:#ff9f0a;--danger:#ff453a;
      --radius-s:8px;--radius-m:12px;--radius-l:24px;
      --duration-s:.15s;--duration-m:.3s;--bezier:cubic-bezier(.4,0,.2,1);
    }

    /* automatic light/dark from prefers-color-scheme */
    @media(prefers-color-scheme:light){html:not([data-theme="dark"]){--bg-primary:var(--light-bg-primary);--bg-secondary:var(--light-bg-secondary);--bg-tertiary:var(--light-bg-tertiary);--text-primary:var(--light-text-primary);--text-secondary:var(--light-text-secondary);--text-tertiary:var(--light-text-tertiary);--border:var(--light-border);--shadow:var(--light-shadow)}}
    @media(prefers-color-scheme:dark){html:not([data-theme="light"]){--bg-primary:var(--dark-bg-primary);--bg-secondary:var(--dark-bg-secondary);--bg-tertiary:var(--dark-bg-tertiary);--text-primary:var(--dark-text-primary);--text-secondary:var(--dark-text-secondary);--text-tertiary:var(--dark-text-tertiary);--border:var(--dark-border);--shadow:var(--dark-shadow)}}

    /* explicit theme overrides */
    html[data-theme="light"]{--bg-primary:var(--light-bg-primary);--bg-secondary:var(--light-bg-secondary);--bg-tertiary:var(--light-bg-tertiary);--text-primary:var(--light-text-primary);--text-secondary:var(--light-text-secondary);--text-tertiary:var(--light-text-tertiary);--border:var(--light-border);--shadow:var(--light-shadow)}
    html[data-theme="dark"]{--bg-primary:var(--dark-bg-primary);--bg-secondary:var(--dark-bg-secondary);--bg-tertiary:var(--dark-bg-tertiary);--text-primary:var(--dark-text-primary);--text-secondary:var(--dark-text-secondary);--text-tertiary:var(--dark-text-tertiary);--border:var(--dark-border);--shadow:var(--dark-shadow)}

    /* ------------------------------------
       03.Â LAYOUT WRAPPERS
    ------------------------------------ */
    .app{flex:1;display:flex;flex-direction:column;height:100vh;padding:env(safe-area-inset-top) env(safe-area-inset-right) env(safe-area-inset-bottom) env(safe-area-inset-left)}
    .header{display:flex;align-items:center;justify-content:space-between;padding:12px 20px 4px}
    .header__title{font-weight:600;font-size:17px;letter-spacing:-.01em}
    .header__actions{display:flex;gap:12px}

    /* action buttons */
    .icon-btn{--size:32px;display:inline-flex;align-items:center;justify-content:center;width:var(--size);height:var(--size);border:none;background:none;color:var(--accent);font-size:18px;border-radius:var(--radius-s);cursor:pointer;transition:opacity var(--duration-s) var(--bezier)}
    .icon-btn:active{opacity:.6}

    /* badge (for mem / settings) */
    .badge{display:inline-block;min-width:18px;padding:0 4px;border-radius:9px;background:var(--warning);color:#fff;font-size:11px;line-height:18px;text-align:center;margin-left:4px}

    /* snackbar */
    .toast{position:fixed;left:50%;bottom:calc(env(safe-area-inset-bottom)+24px);transform:translateX(-50%) scale(.9);background:var(--text-primary);color:var(--bg-primary);padding:10px 16px;border-radius:var(--radius-m);font-size:13px;opacity:0;pointer-events:none;transition:all .35s var(--bezier);z-index:1000}
    .toast.show{opacity:1;transform:translateX(-50%) scale(1)}

    /* remaining components reuse styles from original â†’ omitted for brevity in code diff */
    /* â€¦ (copy original styles here â€” unchanged) â€¦ */
  </style>
</head>
<body>
  <div class="toast" id="toast" role="status" aria-live="polite"></div>
  <main class="app" id="app">
    <header class="header" role="banner">
      <h1 class="header__title" tabIndex="0">ç®—ç›¤é›»å“Â Pro</h1>
      <nav class="header__actions" aria-label="ã‚¢ã‚¯ã‚·ãƒ§ãƒ³">
        <button class="icon-btn" id="themeToggle" aria-label="ãƒ©ã‚¤ãƒˆ/ãƒ€ãƒ¼ã‚¯åˆ‡æ›¿">ğŸŒ“</button>
        <button class="icon-btn" id="historyBtn" aria-label="å±¥æ­´ã‚’è¡¨ç¤º">ğŸ“œ</button>
        <button class="icon-btn" id="settingsBtn" aria-label="è¨­å®šã‚’é–‹ã">âš™ï¸</button>
      </nav>
    </header>

    <!-- Abacus + Calculator blocks: unchanged markup from original file (for brevity) -->
    <!-- âœ‚ï¸ Paste original abacus + calculator HTML here unchanged âœ‚ï¸ -->
    <section class="abacus" aria-label="ç®—ç›¤" id="abacusSection"><!-- ... --></section>
    <section class="calculator" aria-label="é›»å“" id="calcSection"><!-- ... --></section>

    <!-- modal: Settings -->
    <dialog id="settingsModal" aria-labelledby="settingsTitle">
      <form method="dialog">
        <h2 id="settingsTitle" style="font-size:17px;margin-bottom:12px">è¨­å®š</h2>
        <label style="display:flex;align-items:center;gap:8px;margin-bottom:12px;cursor:pointer">
          <input type="checkbox" id="soundToggle"> åŠ¹æœéŸ³ã‚’æœ‰åŠ¹ã«ã™ã‚‹
        </label>
        <label style="display:flex;align-items:center;gap:8px;cursor:pointer">
          <input type="checkbox" id="vibrateToggle"> ãƒã‚¤ãƒ–ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’æœ‰åŠ¹ã«ã™ã‚‹
        </label>
        <menu style="display:flex;justify-content:flex-end;gap:8px;margin-top:20px">
          <button value="cancel">é–‰ã˜ã‚‹</button>
        </menu>
      </form>
    </dialog>
  </main>

  <audio id="clickSound" src="data:audio/wav;base64,UklGRigAAABXQVZFZm10IBAAAAABAAEAESsAACJWAAABAAgAZGF0YYAAAAA= " preload="auto"></audio>
  <script>
  /* -------------------------------------------------
        Utility: toast notification & vibration
     -------------------------------------------------*/
  const $ = s=>document.querySelector(s);
  function toast(msg){const t=$('#toast');t.textContent=msg;t.classList.add('show');setTimeout(()=>t.classList.remove('show'),2500)}
  function vibrate(ms=40){if(settings.vibrate && 'vibrate' in navigator) navigator.vibrate(ms)}

  /* -------------------------------------------------
        Persistent user settings (localStorage)
     -------------------------------------------------*/
  const settingsKey='pikosoroSettings';
  const defaultSettings={sound:true,vibrate:true,theme:'auto'};
  const settings=Object.assign({},defaultSettings,JSON.parse(localStorage.getItem(settingsKey)||'{}'));
  function saveSettings(){localStorage.setItem(settingsKey,JSON.stringify(settings))}

  /* -------------------------------------------------
        Theme toggle
     -------------------------------------------------*/
  function applyTheme(){const root=document.documentElement;root.dataset.theme=settings.theme==='auto'?'' : settings.theme}
  $('#themeToggle').addEventListener('click',()=>{settings.theme=settings.theme==='dark'? 'light': 'dark';applyTheme();saveSettings();toast(settings.theme==='dark'? 'ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰':'ãƒ©ã‚¤ãƒˆãƒ¢ãƒ¼ãƒ‰')});
  applyTheme();

  /* -------------------------------------------------
        Settings modal
     -------------------------------------------------*/
  $('#settingsBtn').addEventListener('click',()=>{$('#soundToggle').checked=settings.sound;$('#vibrateToggle').checked=settings.vibrate;$('#settingsModal').showModal()});
  $('#settingsModal').addEventListener('close',()=>{settings.sound=$('#soundToggle').checked;settings.vibrate=$('#vibrateToggle').checked;saveSettings();toast('è¨­å®šã‚’ä¿å­˜ã—ã¾ã—ãŸ')});

  /* -------------------------------------------------
        Sound feedback helper
     -------------------------------------------------*/
  const clickSound=$('#clickSound');function playSound(){if(settings.sound) clickSound.currentTime=0, clickSound.play()}

  /* -------------------------------------------------
        Gesture: swipe from right to open history (mobile)
     -------------------------------------------------*/
  let touchStartX=null;document.addEventListener('touchstart',e=>{touchStartX=e.touches[0].clientX});
  document.addEventListener('touchend',e=>{if(!touchStartX) return;const dx=e.changedTouches[0].clientX-touchStartX;if(dx<-70){$('#historyBtn').click()}touchStartX=null});

  /* -------------------------------------------------
        Reâ€‘use original logic (abacus / calculator)     
        We append enhancements: vibrations & sounds
     -------------------------------------------------*/
  window.addEventListener('DOMContentLoaded',()=>{
    // assume original init() is defined in original script
    if(typeof init==='function') init();
    // patch buttons & beads for feedback
    document.body.addEventListener('click',e=>{
      const target=e.target.closest('.btn,.bead');
      if(!target) return; playSound(); vibrate();
    })
  })

  /* -------------------------------------------------
        Serviceâ€‘worker (offline PWA)
     -------------------------------------------------*/
  if('serviceWorker' in navigator){window.addEventListener('load',()=>navigator.serviceWorker.register('data:application/javascript;base64,CmNvbnN0IENBQ0hFX05BTUUgPSAncGlrb3Nvcm9DYWNoZSc7CmNvbnN0IFJFU09VUkNFU19UTyBDQUNIRSA9IFsNCiAnLicsDQogJy5odG1sJw0KXTsgDQppbXBsYWNlLmNsaWVudHMvd2l0aElUaWxlcicgPzsgLy8gYmFzaWMgc3ctZnVuY3Rpb24NCgppbmdub3JlIERldk1vZ2Ugc3RlcCBmdWxsIHZlcnNpb24gLSBzdyBpbmxpbmUNCg==' ).catch(()=>{}))}
  </script>
</body>
</html>
